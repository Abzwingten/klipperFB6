Итак, коллеги, мы решили проблему с прошивкой новой ревизии принтеров. Огромное спасибо всем, кто принял участие, особенно @ub8cjz , который грамотно определил проблему, и @R_e_w_w_a_n который также консультировал по многим вопросам в данной проблеме. Для тех, кто еще не в курсе: в последней ревизии китайцы решили удешевить производство и вместо контроллера stm32, к которому по юсб подключались напрямую, поставили gd32 и использовали для подключения костыль в виде ch340. После прошивки на Марлин от Павла, или на сток с ЛА, а также сток в оф. сайта, вы больше не сможете получать команды с принтера по юсб и управлять им. Также на стоке с ЛА (на марлин не обратил внимания), принтер игнорировал команду из джикода на нагрев, в ручную работал(на новой прошивке еще не успел проверить). Данной прошивки пока нет нигде и выкладывается она впервые.

Почти наверняка пользователи перешитого марлина могут и не подозревать, что у них не STM32, а GD32, пока не попытаются подключиться по USB

[Марлин под Nano4 v3.2 - GD32+CH340, "красная плата"](/Ghost6-GD.zip)

На GD32 платы появились относительно недавно, в чате они не на слуху.

Первое значимое появление - проблема с клиппером, потребовалось указать, что соединение идёт через внешний USB-UART чип.
В тот же раз выяснилось, что клиппер не умеет на GD32 измерять собственную температуру кристалла, т.к. в чипе в OTP нет таблицы калибровки датчика температуры, в результате клиппер падал с делением на 0

В этом франкенштейне стоит чип GD32F407, связанный с миром по USB CH340.

При настройке клиппера для работы с USB нужно:
процессор STM32F407
бутлоадер 48К
тактовая частота 8МГц
Интерфейс связи USART3 (PB11/PB10)

НЕ РАБОТАЕТ термодатчик в MCU, ошибка "float divizion by zero" - закомментировать ВСЮ секцию [temperature_sensor mcu_temp]

При подключении платы к одноплатнику по UART доступен ТОЛЬКО порт USART1 на сокете WiFi. USART3 на четырёхконтактной гребёнке занят CH340

![](/GD32.jpg)